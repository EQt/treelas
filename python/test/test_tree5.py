import numpy as np
import treelas as tl


def test1():
    y = np.array([0.81676685, 0.69844091, 0.95493251, 0.67952007, 0.58081567,
                  0.6255922 , 0.43098053, 0.22310044, 0.12413183, 0.27741422])
    t = tl.tree.TreeInstance(y=y, parent=[0, 0, 1, 2, 3, 0, 7, 8, 3, 8], lam=0.1)
    x = t.solve().x
    xt = np.array([0.75671342, 0.75671342, 0.75671342, 0.63016787, 0.63016787,
                   0.7255922 , 0.33098053, 0.27488216, 0.27488216, 0.27488216])
    assert np.abs(x - xt).max() < 1e-8


def test2():
    y = np.array([0.81676685, 0.69844091, 0.95493251, 0.67952007, 0.58081567,
                  0.6255922 , 0.43098053, 0.22310044, 0.12413183, 0.27741422])
    t = tl.tree.TreeInstance(y=y, parent=[0, 0, 1, 2, 3, 0, 7, 8, 3, 8], lam=0.1)
    t.solve()
    g = t.gamma
    assert g.min() > -1e-10
    assert g.max() < +1e-10
